CREATE DATABASE PH18705_LAB1234;
GO
USE PH18705_LAB1234;
GO

CREATE TABLE SINHVIEN
(
    MaSV VARCHAR(20) PRIMARY KEY,
    HoTenSV NVARCHAR(50) NOT NULL,
    GioiTinh NVARCHAR(10) NOT NULL,
    NgSinh DATE not NULL,
    DiaChi NVARCHAR(100) not NULL,
    SDThoai NVARCHAR(12) NOT NULL,
);

CREATE TABLE MONHOC
(
    MaMH VARCHAR(20) PRIMARY KEY,
    TenMH NVARCHAR(50) NOT NULL,
    STChi NVARCHAR(50) NOT NULL,
)

CREATE TABLE DANGKY
(
    MaSV VARCHAR(20) NOT NULL,
    MaMH VARCHAR(20) NOT NULL,
    NgayDK DATE NOT NULL,
    HocKy VARCHAR(10) NOT NULL,
)

ALTER TABLE DANGKY
ADD CONSTRAINT MaSV_PK
FOREIGN KEY (MaSV)
REFERENCES SINHVIEN(MaSV)

ALTER TABLE DANGKY
ADD CONSTRAINT MaMH_PK
FOREIGN KEY (MaMH)
REFERENCES MONHOC(MaMH)

INSERT INTO SINHVIEN(MaSV, HoTenSV, GioiTinh, NgSinh, DiaChi, SDThoai)
VALUES 
('PH18705', N'Nguyễn Văn A', N'Nam', '2000-9-16', N'Tuyên Quang', '0123456789'),
('PH18706', N'Nguyễn Văn B', N'Nam', '2001-5-17', N'Hà Giang', '0123456788'),
('PH18707', N'Nguyễn Văn C', N'Nam', '2002-8-18', N'Hải Dương', '0123456787'),
('PH18708', N'Nguyễn Văn D', N'Nam', '1999-6-19', N'Nam Định', '0123456786'),
('PH18709', N'Nguyễn Văn E', N'Nam', '1998-4-20', N'Hà Nội', '0123456785');


INSERT INTO MONHOC
VALUES
('COM1245', N'Cơ sở dữ liệu', '3'),
('IT1365', N'Lập trình C#', '3'),
('TA1246', N'Tiếng Anh', '2'),
('TH8856', N'Tin Học', '1');

INSERT INTO DANGKY(MaSV, MaMH, NgayDK, HocKy)
VALUES
('PH18705', 'COM1245', '2022-1-10', '2'),
('PH18706', 'COM1245', '2022-1-15', '3'),
('PH18706', 'IT1365', '2022-1-5', '3'),
('PH18707', 'TA1246', '2022-1-10', '2'),
('PH18707', 'COM1245', '2022-1-15', '1'),
('PH18707', 'TH8856', '2022-1-5', '4'),
('PH18708', 'TH8856', '2022-1-10', '5'),
('PH18708', 'COM1245', '2022-1-15', '2'),
('PH18709', 'IT1365', '2022-1-2', '4'),
('PH18709', 'TH8856', '2022-1-7', '3');

SELECT SINHVIEN.MaSV, HoTenSV, GioiTinh, NgSinh, 2022-YEAR(SINHVIEN.NgSinh) AS N'Tuổi', MONHOC.TenMH, DANGKY.NgayDK, HocKy  FROM SINHVIEN
INNER JOIN DANGKY
on SINHVIEN.MaSV = DANGKY.MaSV
INNER JOIN MONHOC 
ON MONHOC.MaMH = DANGKY.MaMH
WHERE SINHVIEN.HoTenSV LIKE '%D%'

